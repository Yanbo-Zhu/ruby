

编程都是要创建抽象的代码来描述和处理数据，要创建抽象，必须要为在代码中分配名称来表示事物。 变量只不过是为数据创建一个名称的一种方式。

# 1 创建和分配变量

在某些语言中，需要在为一个变量分配值之前声明这个变量。 当为变量分配值时，会自动创建Ruby变量。下面来试试一个例子：

![](http://www.yiibai.com/uploads/images/201705/1105/455170517_12524.png)

`a = 250`表示创建一个名称为`a`的变量，并将值`250`存储到其中。

**右边优先**

在英文表达式中，是从左到右阅读，所以从左到右读取代码是很自然的。 但是当使用单个等于号(`=`)评估求值一个赋值时，Ruby实际上首先评估求值右侧。 举个例子：

```shell
irb(main):010:0> b = 10 + 20
=> 30
irb(main):011:0> b
=> 30
irb(main):012:0>
```

上面示例中，首先对`10 + 20`进行评估求值，再将求值结果存储到`b`变量中。

**灵活输入**

Ruby的变量可以容纳任何类型的数据，甚至可以更改其持有的数据类型。 例如：

```shell
irb(main):012:0> c = 200
=> 200
irb(main):013:0> c = "Flexible Typing"
=> "Flexible Typing"
irb(main):014:0> c
=> "Flexible Typing"
irb(main):015:0> c = 0.0001
=> 0.0001
irb(main):016:0> c
=> 0.0001
irb(main):017:0>
```

第一次赋予`c`变量为一个`200`的整数值。第二次赋值是将`c`变量的值更改其为“`Flexible Typing`”。

## 1.1 **命名变量**

大多数Ruby变量(局部变量)的命名都有一些由`VM`强制的要求。这些要求约定如下 -

- 始终以小写字母开头(允许下划线，虽然不常见)
- 不能使用空格
- 不要包含特殊字符，如`$`，`@`和`＆`

除了那些虚拟机的要求，Ruby开发者对变量名称有几个常见风格偏好：

- 使用蛇形大小写，即：名称中的每个字都是小写字母，并用下划线(`_`)连接
- 以其内容的含义命名，而不是其内容的类型
- 不使用缩写

好的变量名的示例如下：`count`，`total_products`，`students_in_class`或`first_lesson`。

一些不好的Ruby变量名称的几个例子，如下所示：

- `studentsInClass` – 使用骆驼案而不是蛇形大小写，应该命名为：`students_in_class`
- `1st_lesson` – 变量不能以数字开头，应该命名为：`first_lesson`
- `students_array` – 包括名称的数据类型，应该命名为：`students`
- `sts` – 不使用缩写，应该命名为：`students`


# 2 变量类型

Ruby变量是用于保存在程序中使用的数据的位置。 每个变量都有不同的名称。 这些变量名称基于一些命名约定。 
不像其他编程语言，在[Ruby](http://www.yiibai.com/ruby/ "Ruby")中不必先声明变量再使用。 只需要一个前缀来指示它就可以了。

Ruby中有四种类型的变量：
- 局部变量
- 类变量
- 实例变量
- 全局变量

## 2.1 局部变量

局部变量名以小写字母或下划线(`_`)开头。变量可在它的初始化块内或范围内访问。代码块完成后，变量就不在作用域存在了。
当未初始化的局部变量被调用时，它们被解释为对没有参数的方法的调用。

## 2.2 类变量

类变量名以`@@`符号开头。需要在使用前进行初始化。 类变量属于整个类，可以从类中的任何位置访问。 如果在一个实例中该值将被更改，则它将在每个实例中被改变。

类变量由类的所有后代共享，未初始化的类变量将导致错误。

**示例：**

创建一个Ruby文件：_class-variables.rb_，编写以下代码 -

```ruby
#!/usr/bin/ruby   

class States   
   @@no_of_states=0   
   def initialize(name)   
      @states_name=name   
      @@no_of_states += 1   
   end   
   def display()   
     puts "State name #@state_name"   
    end   
    def total_no_of_states()   
       puts "Total number of states written: #@@no_of_states"   
    end   
end   

# Create Objects   
first=States.new("Assam")   
second=States.new("Meghalaya")   
third=States.new("Maharashtra")   
fourth=States.new("Pondicherry")   

# Call Methods   
first.total_no_of_states()   
second.total_no_of_states()   
third.total_no_of_states()   
fourth.total_no_of_states()
```

在上面的例子中，`@[@no_of_states](https://github.com/no_of_states "@no_of_states")`是一个类变量。

执行上面代码，输出结果如下：

```shell
F:\worksp\ruby>ruby class-variables.rb
Total number of states written: 4
Total number of states written: 4
Total number of states written: 4
Total number of states written: 4

F:\worksp\ruby>
```

## 2.3 实例变量

实例变量名以`@`符号开头。 它属于类的一个实例，可以从方法中的类的任何实例访问。 它们只能访问一个特定的类的实例。

它们不需要初始化，未初始化的实例变量的值是：`nil` 。

**示例：**

创建一个Ruby文件：_instance-variables.rb_，编写以下代码 -

```ruby
#!/usr/bin/ruby   

class States   
   def initialize(name)   
      @states_name=name   
   end   
   def display()   
      puts "States name #@states_name"   
    end   
end   

# Create Objects   
first=States.new("Hainan")   
second=States.new("GuangDong")   
third=States.new("Beijing")   
fourth=States.new("ShangDong")   

# Call Methods   
first.display()   
second.display()   
third.display()   
fourth.display()
```

执行上面代码，输出结果如下：

```shell
F:\worksp\ruby>ruby instance-variables.rb
States name Hainan
States name GuangDong
States name Beijing
States name ShangDong

F:\worksp\ruby>
```

## 2.4 全局变量

全局变量名以`$`号开头。在全局范围内可访问，可以从程序中的任何位置访问它。

未初始化的全局变量的值会被初始化为：`nil`。建议不要使用全局变量，因为它们使程序变得秘密和复杂。

Ruby中有一些预定义的全局变量。

**示例：**

创建一个Ruby文件：_global-variables.rb_，编写以下代码 -

```ruby
#!/usr/bin/ruby   

$global_var = "GLOBAL"   
class One   
  def display   
     puts "Global variable in One is #$global_var"   
  end   
end   
class Two   
  def display   
     puts "Global variable in Two is #$global_var"   
  end   
end   

oneobj = One.new   
oneobj.display   
twoobj = Two.new   
twoobj.display
```

执行上面代码，输出结果如下：

```shell
F:\worksp\ruby>ruby global-variables.rb
Global variable in One is GLOBAL
Global variable in Two is GLOBAL

F:\worksp\ruby>
```

## 2.5 总结

以下是上面几种类型变量的概括 -

|特性|局部变量|全局变量|实例变量|类变量|
|---|---|---|---|---|
|范围|仅限于初始化块内|全局范围|属于一个类的一个实例|仅限于创建它们的整个类|
|命名约定|以小写字母或下划线(`_`)开头|以`$`符号开头|以`@`符号开头|以`@@`符号开头|
|初始化|不需要初始化，未初始化的局部变量被解释为没有参数的方法|不需要初始化，未初始化的全局变量的值为:`nil`。|不需要初始化,未初始化的实例变量的值为:`nil`。|需要在使用前进行初始化,未初始化的全局变量会导致错误。|






